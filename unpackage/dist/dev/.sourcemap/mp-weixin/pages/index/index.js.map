{"version":3,"sources":["uni-app:///main.js","webpack:///D:/BaiduSyncdisk/毕设/Desktop/vts-wechat/pages/index/index.vue?cc65","webpack:///D:/BaiduSyncdisk/毕设/Desktop/vts-wechat/pages/index/index.vue?f00b","webpack:///D:/BaiduSyncdisk/毕设/Desktop/vts-wechat/pages/index/index.vue?1b75","webpack:///D:/BaiduSyncdisk/毕设/Desktop/vts-wechat/pages/index/index.vue?8902","uni-app:///pages/index/index.vue","webpack:///D:/BaiduSyncdisk/毕设/Desktop/vts-wechat/pages/index/index.vue?759e","webpack:///D:/BaiduSyncdisk/毕设/Desktop/vts-wechat/pages/index/index.vue?1ecf"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","longitude","latitude","province","city","area","street","address","data","title","isStart","allShow","extra","timer","timer2","temp","vehicleId","speed","direction","accuracy","reportTime","covers","id","iconPath","width","height","polygons","fence","notInFence","overSpeed","computed","onLoad","console","that","vehicleNum","onShow","onPullDownRefresh","setTimeout","uni","onHide","onUnload","clearInterval","methods","_locationChangeFn","mapWeizhi2","markers","clickUpload","success","scope","_this","startUpload","icon","alarmType","alarmSpeed","alarmLat","alarmLng","alarmTime","endUpload","isGetLocation","getAuthorizeInfo","getLocation","type","isHighAccuracy","bgetLocationInfo","location","key","qqmapsdk","resolve","fail","initPolygons","tmpPoints","points","strokeWidth","strokeColor","fillColor","zIndex","isPointInPolygon","inside","moreThanOneHour","sendRequest1","startTime","res"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,cAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;AACa;;;AAGjE;AACwM;AACxM,gBAAgB,4MAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,mTAEN;AACP,KAAK;AACL;AACA,aAAa,uPAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACtCA;AAAA;AAAA;AAAA;AAA2xB,CAAgB,0wBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;AC2B/yB;AAKA;AACA;AAAA;AAAA;AAEA;EACAC;EACAC;EACAC;EACAC;EACAC;EACAC;EACAC;AACA;AAAA,eACA;EACAC;IACA;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;QACAC;QACAf;QACAC;QACAe;QACAC;QACAC;QACAC;MACA;MACAlB;MACAD;MACAoB;QACAC;QACApB;QACAD;QACAsB;QACAC;QACAC;MACA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;IACA;EACA;EACAC,4BACA,6DACA;EACAC;IACAC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACAC;IACA;IACA;MACAA;IACA;IACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;IAGA;IACAA;IACAD;IAEA;MACA;MACAC;QAAAC;MAAA;MACAF;IACA;IAEAA;EACA;EACAG;IACA;EAEA;EACA;EACAC;IACAJ;IACA;IACA;IACAK;MACA;MACAC;IACA;EACA;EACAC;IACAP;EACA;EACAQ;IACA;MACAC;MACA;IACA;EACA;EACAC,yCACA;IAAA;IACAC;MACAX;IACA;IACA;IACAY;MACA;MACA;MACAX;QAAA;QACA;UACA;UACAY;UACAA;UACAZ;YACAY;UACA;UACAZ;UACArC;QACA;QACAA;MACA;IACA;IACA;IACAkD;MACA;MACAR;QACAS;UACAf;UACA;UACA;YACA;YACAM;cACAU;cACAD;gBACAE;cACA;YACA;UACA;YAAA;YACAA;UACA;QACA;MACA;IACA;IACAC;MACA;MACAD;MACAX;QACA7B;QACA0C;MACA;MACAd;QACAY;MACA;MACAjB;MACAiB;;MAEA;MACAX;QACAN;QAEAiB;UAAA;UACA;YACAjB;YACA;YACAiB;YACAA;YACAA;YACAA;YACAA;YACAA;YACAA;YACAA;YACAA;YACAA;YACAA;YACA;YACA;YACA;cACAA;cACA;gBACA;gBACAA;kBACAjC;kBACAoC;kBACAC;kBACAC;kBACAC;kBACAC;gBACA;kBACAxB;kBACAiB;gBACA;cACA;YACA;YACA;YACA;cACA;cACAA;gBAAAjC;cAAA;gBACA;gBACA;gBACA;kBACA;kBACAiC;oBACAjC;oBACAoC;oBACAC;oBACAC;oBACAC;oBACAC;kBACA;oBACAxB;kBACA;gBACA;cACA;YACA;YACA;YACAiB;YACA;YACAX;UACA;UACAA;QACA;MACA;IACA;IACAmB;MACA;MACAR;MACAX;QACA7B;QACA0C;MACA;MACAd;QACAY;QACAA;QACA;QACAX;UACA;UACAG;QACA;MACA;MACAT;IAEA;IAEA;IACA0B;MAAA;MACA;MACApB;QACAS;UACAf;UACA;UACA;YACAiB;UACA;YACAA;UACA;QACA;MACA;IACA;IAEAU;MAAA;MAAA;MACA;MACArB;QACAU;QACAD;UAAA;UACA;UACA;UACA;UACAE;QACA;MACA;IACA;IACAW;MAAA;MACAtB;QACAuB;QACAC;QACAf;UACAf;UACAA;UACA;UACA;UACA;UACA;UACA;YACA;YACA;YACA;UAAA,CACA;YACAM;cACA7B;cACA0C;YACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACAnB;UACAA;UACA;UACA;UACA;UACA;QACA;MACA;IACA;IACA;IACA;IACA+B;MACA;QACAzB;UACAuB;UACAC;UACAf;YACAiB;YACAA;YACAhC;YACAA;YACAA;YACAA;YACA;cACAiC;YACA;;YACAC;cACAF;cACAjB;gBACA;gBACAf;gBACAgC;gBACAA;gBACAA;gBACAA;gBACAA;gBACA;gBACAG;cACA;YACA;UAEA;UACAC;YACApC;YACAmC;UACA;QACA;MACA;IACA;IACA;IACAE;MACA;MACApC;QAAAX;MAAA;QACAU;QACAC;QACA;QACA;QACA;QACAqC;UACAC;YACArE;YACAD;UACA;QACA;QACAgC,iBACA;UACAsC;UACAC;UACAC;UAAA;UACAC;UAAA;UACAC;QACA,EACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MAEA;QACA;QACA;QACA;QACA;QAEA;QACA;UACAC;QACA;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;QACA;MACA;QACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OACA;kBACA/D;kBACAgE;gBACA;cAAA;gBAHAC;gBAIA;gBACAjD;gBACAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;EAAA;AAEA;AAAA,2B;;;;;;;;;;;;;ACxdA;AAAA;AAAA;AAAA;AAAwnC,CAAgB,6jCAAG,EAAC,C;;;;;;;;;;;ACA5oC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/index/index.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/index/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=57280228&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/index/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=57280228&\"","var components\ntry {\n  components = {\n    uOverlay: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-overlay/u-overlay\" */ \"@/uni_modules/uview-ui/components/u-overlay/u-overlay.vue\"\n      )\n    },\n    uniCard: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-card/components/uni-card/uni-card\" */ \"@/uni_modules/uni-card/components/uni-card/uni-card.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view >\r\n\t\t<!-- // 地图 -->\r\n\t\t<view >\t\r\n\t\t\t<map class=\"map\" \r\n\t\t\t:latitude=\"latitude\"\r\n\t\t\t:longitude=\"longitude\" \r\n\t\t\t:markers=\"covers\"\r\n\t\t\t:polygons=\"polygons\"\r\n\t\t\t>\r\n\t\t\t</map>\r\n\t\t</view>\r\n\t\t\r\n\t\t<view class=\"content\">\r\n\t\t\t<u-overlay :show=\"allShow\" :duration=\"100\" :z-index =\"999\" :opacity=\"0.3\"></u-overlay>\r\n\t\t\t<uni-card :title=\"vehicleId?vehicleNum:'未绑定'\"  :extra=\"extra\" thumbnail=\"/static/image/vehicle.png\">\r\n\t\t\t\t<text>温馨提示：请确保开启后台定位再开始上传数据！</text>\r\n\t\t\t\t<button class =\"btn1\" type=\"primary\" @click=\"isGetLocation()\" style=\"margin-top: 50rpx;margin-bottom: 30rpx;\" >定位当前位置</button>\r\n\t\t\t\t<button class=\"btn1\" type=\"primary\" @click=\"clickUpload()\" style=\"margin-top: 30rpx;\" :disabled=\"isStart||(!vehicleId)\">开始上传</button>\r\n\t\t\t\t<button class=\"btn1\" type=\"primary\" @click=\"endUpload()\" style=\"margin-top: 30rpx;\" :disabled=\" (!vehicleId) \">停止上传</button>\r\n\t\t\t</uni-card>\r\n\t\t</view>\r\n\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tmapState, // 从vuex中引入mapState函数，用于在计算属性中映射store中的state\r\n\t\tmapActions, // 从vuex中引入mapActions函数，用于在methods中映射store中的actions\r\n\t\tmapGetters // 从vuex中引入mapGetters函数，用于在计算属性中映射store中的getters\r\n\t} from 'vuex'\r\n\timport QQMapWX from \"@/common/qqmap-wx-jssdk1.1/qqmap-wx-jssdk.min.js\"\r\n\timport { getCurrentTime, getTimestamp } from \"@/utils/utils.js\"\r\n\t\r\n\tlet location = {\r\n\t       longitude: 0,\r\n\t       latitude: 0,\r\n\t       province: \"\",\r\n\t       city: \"\",\r\n\t       area: \"\",\r\n\t       street: \"\",\r\n\t       address: \"\",\r\n\t}\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttitle:\"温馨提示：请确保开启后台定位再点击上传数据！\" ,\r\n\t\t\t\tisStart:false, //上传GPS数据是否开始\r\n\t\t\t\tallShow:false, //全局遮罩\r\n\t\t\t\textra:\"当前车辆\" ,\r\n\t\t\t\ttimer: null , // 定时器编号\r\n\t\t\t\ttimer2:null , // 用于更新电子围栏\r\n\t\t\t\ttemp:{                  \r\n\t\t\t\t\tvehicleId:0,\r\n\t\t\t\t\tlongitude:0,\r\n\t\t\t\t\tlatitude:0,\r\n\t\t\t\t\tspeed:0,\r\n\t\t\t\t\tdirection:0,\r\n\t\t\t\t\taccuracy:0 ,\r\n\t\t\t\t\treportTime:\"\",\r\n\t\t\t\t},\r\n\t\t\t\tlatitude : 39.909 ,\r\n\t\t\t\tlongitude : 116.39742 ,\r\n\t\t\t\tcovers: [{\r\n\t\t\t\t\tid: 1 ,\r\n\t\t\t\t\tlatitude: 39.909,\r\n\t\t\t\t\tlongitude: 116.39742,\r\n\t\t\t\t\ticonPath: 'https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/markerNew.png' ,\r\n\t\t\t\t\twidth: \"40\",\r\n\t\t\t\t\theight: \"40\"\r\n\t\t\t\t}],\r\n\t\t\t\tpolygons:null , //多边形\r\n\t\t\t\tfence: null ,//电子围栏\r\n\t\t\t\tnotInFence:0 ,\r\n\t\t\t\toverSpeed:0 \r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState(['vehicleNum',\"vehicleId\",\"driverId\"]),   // 得到车牌号 和id\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tconsole.log(\"进入index页面onLoad\")\r\n\t\t\tconst that = this;\r\n\t\t\t// that.$api.getFence\r\n\t\t\t// that.$api.getFence({id:1}).then((res) => {\r\n\t\t\t// \tconsole.log('fence',res)\r\n\t\t\t// \tthat.fence =  res.datas\r\n\t\t\t// \tconsole.log('电子围栏', that.fence)\r\n\t\t\t// \tthat.polygons = JSON.parse(that.fence.points)\r\n\t\t\t// })\r\n\t\t\tthat.initPolygons()\r\n\t\t\t// 每间隔一个小时更新一次\r\n\t\t\tthis.timer2 = setInterval(()=>{\r\n\t\t\t\tthat.initPolygons()\r\n\t\t\t},1000 * 3600)\r\n\t\t\t/*\r\n\t\t\tuni.getStorage({\r\n\t\t\t\tkey:\"userInfo\"\r\n\t\t\t}).then((res)=>{\r\n\t\t\t\tconsole.log(\"userInfo\",res)\r\n\t\t\t\tlet userInfo = res[1].data\r\n\t\t\t\tconsole.log(\"userinfo\",userInfo)\r\n\t\t\t\tthat.setDriver(userInfo)\r\n\t\t\t\tif(userInfo.vehicleId > 0){\r\n\t\t\t\t\tuni.getStorage({\r\n\t\t\t\t\t\tkey:\"vehicleInfo\"\r\n\t\t\t\t\t}).then((res)=> {\r\n\t\t\t\t\t\tconsole.log(\"vehicleInfo\",res)\r\n\t\t\t\t\t\tthat.setVehicleNum({\r\n\t\t\t\t\t\t\tvehicleNum: res[1].data.vehicleNum\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// that.$api.queryVehicleById({\r\n\t\t\t\t\t// \tvehicleId:userInfo.vehicleId\r\n\t\t\t\t\t// }).then((res) => {\r\n\t\t\t\t\t// \tconsole.log(\"获取到车辆信息\",res)\r\n\t\t\t\t\t// \t// that.vehicleNum = res.datas.vehicleNum\r\n\t\t\t\t\t// })\r\n\t\t\t\t}\r\n\r\n\t\t\t})*/\r\n\t\t\tlet userInfo = uni.getStorageSync(\"userInfo\")\r\n\t\t\tthat.setDriver(userInfo)\r\n\t\t\tconsole.log(\"index页面OnLoad方法内部1\",userInfo)\r\n\t\t\t\r\n\t\t\tif(userInfo.vehicleId>0){\r\n\t\t\t\tlet vehicleInfo = uni.getStorageSync(\"vehicleInfo\")\r\n\t\t\t\tthat.setVehicleNum({vehicleNum:vehicleInfo.vehicleNum})\r\n\t\t\t\tconsole.log(\"index页面OnLoad方法内部2\",vehicleInfo)\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(\"index页面OnLoad方法内部3\",this.$store.state)\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tconst that = this;\r\n\t\t\t\r\n\t\t},\r\n\t\t// 监听到下拉刷新\r\n\t\tonPullDownRefresh() {\r\n\t\t\tconsole.log(\"监听到下拉刷新\");\r\n\t\t\tthis.initPolygons()\r\n\t\t\tthis.isGetLocation()\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t// 模拟1秒后停止下拉刷新显示样式\r\n\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t}, 1000)\r\n\t\t}, \r\n\t\tonHide() {\r\n\t\t\tconsole.log('页面消失了');\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tif(this.timer2){\r\n\t\t\t\tclearInterval(this.timer2)\r\n\t\t\t\tthis.timer2 = null\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapActions(['setDriver','setVehicleNum']), // 映射store中的actions到方法中\r\n\t\t\t_locationChangeFn(res) {\r\n\t\t\t  console.log('location change', res)\r\n\t\t\t },\r\n\t\t\t //监听地理位置变化\r\n\t\t\t mapWeizhi2: function () {\n\t\t\t\tvar that = this;\n\t\t\t\t//定时执行每隔40秒获取当前位置（配送员）一次\n\t\t\t\tthat.timer = setInterval(function () { //这里把setInterval赋值给变量名为timer的变量\n\t\t\t\t  const _locationChangeFn = function (res) {\n\t\t\t\t\tvar markers = that.data.markers;\n\t\t\t\t\tmarkers[0].latitude = res.latitude;\n\t\t\t\t\tmarkers[0].longitude = res.longitude;\n\t\t\t\t\tthat.setData({\n\t\t\t\t\t  markers,\n\t\t\t\t\t})\n\t\t\t\t\tthat.GetDistance();\n\t\t\t\t\twx.offLocationChange(_locationChangeFn)\n\t\t\t\t  }\n\t\t\t\t  wx.onLocationChange(_locationChangeFn)\n\t\t\t\t}, 5000)\n\t\t\t  },\r\n\t\t\t//点击开始上传按钮\r\n\t\t\tclickUpload(){\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tuni.getSetting({\r\n\t\t\t\t\tsuccess(res){\r\n\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t\t//每次进入程序判断当前是否获得授权，如果没有就去获得授权，如果获得授权，就直接获取当前地理位置\r\n\t\t\t\t\t\tif(!res.authSetting[\"scope.userLocationBackground\"]){\r\n\t\t\t\t\t\t\t//  没有授权就先弹窗授权\r\n\t\t\t\t\t\t\tuni.authorize({\r\n\t\t\t\t\t\t\t\tscope:\"scope.userLocationBackground\",\r\n\t\t\t\t\t\t\t\tsuccess(){\r\n\t\t\t\t\t\t\t\t\t_this.startUpload()  //完成授权开始上传\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}else{  //已经授权\r\n\t\t\t\t\t\t\t_this.startUpload()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tstartUpload(){\r\n\t\t\t\tlet _this = this\r\n\t\t\t\t_this.allShow = true\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: \"正在开启\",\r\n\t\t\t\t\ticon: 'loading'\r\n\t\t\t\t})\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t_this.allShow = false\r\n\t\t\t\t},2000)\r\n\t\t\t\tconsole.log(\"点击开始上传GPS数据\")\r\n\t\t\t\t_this.isStart = true\r\n\t\t\t\t\r\n\t\t\t\t//开启前后台位置变化监测\r\n\t\t\t\tuni.startLocationUpdateBackground().then((res) => {\r\n\t\t\t\t\tconsole.log(\"开启前后台位置变化监测\", res);\r\n\t\t\t\t\t\r\n\t\t\t\t\t_this.timer =  setInterval(function () { //这里把setInterval赋值给变量名为timer的变量\n\t\t\t\t\t  const _locationChangeFn = function (res) {\r\n\t\t\t\t\t\t  console.log(\"location change:+\",res)\r\n\t\t\t\t\t\t//将经纬度赋给地图标记点\r\n\t\t\t\t\t\t_this.latitude = res.latitude\r\n\t\t\t\t\t\t_this.longitude = res.longitude\r\n\t\t\t\t\t\t_this.covers[0].latitude = res.latitude\r\n\t\t\t\t\t\t_this.covers[0].longitude = res.longitude;\r\n\t\t\t\t\t\t_this.temp.vehicleId = _this.vehicleId  //vuex中的数据\r\n\t\t\t\t\t\t_this.temp.latitude = res.latitude\r\n\t\t\t\t\t\t_this.temp.longitude = res.longitude\r\n\t\t\t\t\t\t_this.temp.speed = res.speed\r\n\t\t\t\t\t\t_this.temp.direction = res.direction\r\n\t\t\t\t\t\t_this.temp.accuracy = res.accuracy\r\n\t\t\t\t\t\t_this.temp.reportTime = _this.$utils.getCurrentTime()\r\n\t\t\t\t\t\t//console.log(_this.temp)\r\n\t\t\t\t\t\t//超速\r\n\t\t\t\t\t\tif(_this.temp.speed *3.6 > _this.fence.maxSpeed){\r\n\t\t\t\t\t\t\t_this.overSpeed += 1\r\n\t\t\t\t\t\t\tif(_this.overSpeed >= 12){\r\n\t\t\t\t\t\t\t\t//上传报警信息\r\n\t\t\t\t\t\t\t\t_this.$api.insertAlarm({\r\n\t\t\t\t\t\t\t\t\tvehicleId:_this.vehicleId,\r\n\t\t\t\t\t\t\t\t\talarmType:0,\r\n\t\t\t\t\t\t\t\t\talarmSpeed:_this.temp.speed * 3.6,\r\n\t\t\t\t\t\t\t\t\talarmLat:_this.temp.latitude,\r\n\t\t\t\t\t\t\t\t\talarmLng: _this.temp.longitude,\r\n\t\t\t\t\t\t\t\t\talarmTime: _this.$utils.getCurrentTime()\r\n\t\t\t\t\t\t\t\t}).then((Response)=>{\r\n\t\t\t\t\t\t\t\t\tconsole.log('超速报警')\r\n\t\t\t\t\t\t\t\t\t_this.overSpeed = 0\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//超出电子围栏\r\n\t\t\t\t\t\tif(!_this.isPointInPolygon(_this.covers[0],_this.polygons[0].points)){\r\n\t\t\t\t\t\t\t//TODO ->报警！\r\n\t\t\t\t\t\t\t_this.$api.getLastAlarm({vehicleId:_this.vehicleId}).then((res)=>{\r\n\t\t\t\t\t\t\t\t// console.log('上一次报警信息',res.datas.alarm)\r\n\t\t\t\t\t\t\t\tlet alarmInfo =  res.datas.alarm\r\n\t\t\t\t\t\t\t\tif(_this.moreThanOneHour(alarmInfo.alarmTime)&&alarmInfo.alarmType==1){\r\n\t\t\t\t\t\t\t\t\t//超过一小时，上传警报信息\r\n\t\t\t\t\t\t\t\t\t_this.$api.insertAlarm({\r\n\t\t\t\t\t\t\t\t\t\tvehicleId:_this.vehicleId,\r\n\t\t\t\t\t\t\t\t\t\talarmType:1,\r\n\t\t\t\t\t\t\t\t\t\talarmSpeed:_this.temp.speed,\r\n\t\t\t\t\t\t\t\t\t\talarmLat:_this.temp.latitude,\r\n\t\t\t\t\t\t\t\t\t\talarmLng: _this.temp.longitude,\r\n\t\t\t\t\t\t\t\t\t\talarmTime: _this.$utils.getCurrentTime()\r\n\t\t\t\t\t\t\t\t\t}).then((Response)=>{\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('上传超过围栏报警')\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//上传数据\r\n\t\t\t\t\t\t_this.$api.insertLocation(_this.temp)\r\n\t\t\t\t\t\t//关闭\n\t\t\t\t\t\tuni.offLocationChange(_locationChangeFn)\n\t\t\t\t\t  }\n\t\t\t\t\t  uni.onLocationChange(_locationChangeFn)\n\t\t\t\t\t}, 5000)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tendUpload(){\r\n\t\t\t\tlet _this = this\r\n\t\t\t\t_this.allShow = true\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: \"正在关闭\",\r\n\t\t\t\t\ticon: 'loading'\r\n\t\t\t\t})\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t_this.allShow = false\r\n\t\t\t\t\t_this.isStart = false\r\n\t\t\t\t\t// \t前后台都关闭监听\r\n\t\t\t\t\tuni.stopLocationUpdate().then((res)=>{\r\n\t\t\t\t\t\t//取消定时器\r\n\t\t\t\t\t\tclearInterval(_this.timer)\r\n\t\t\t\t\t})\r\n\t\t\t\t},2000)\r\n\t\t\t\tconsole.log(\"关闭上传GPS数据\")\r\n\t\t\t\t\r\n\t\t\t},\r\n\r\n\t\t\t//获取定位信息\r\n\t\t\tisGetLocation(a = \"scope.userLocation\"){\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tuni.getSetting({\r\n\t\t\t\t\tsuccess(res){\r\n\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t\t//每次进入程序判断当前是否获得授权，如果没有就去获得授权，如果获得授权，就直接获取当前地理位置\r\n\t\t\t\t\t\tif(!res.authSetting[a]){\r\n\t\t\t\t\t\t\t\t_this.getAuthorizeInfo()\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t_this.getLocation();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tgetAuthorizeInfo(a = \"scope.userLocation\") { // uniapp弹窗弹出获取授权（地理，个人微信信息等授权信息）弹窗\r\n\t\t\t\tvar _this = this;\r\n\t\t\t\tuni.authorize({\r\n\t\t\t\t\tscope: a,\r\n\t\t\t\t\tsuccess() { //允许授权\r\n\t\t\t\t\t\t//方式一\r\n\t\t\t\t\t\t// _this.getLocationInfo();\r\n\t\t\t\t\t\t// 方式二\r\n\t\t\t\t\t\t_this.getLocation();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetLocation(){\r\n\t\t\t\tuni.getLocation({\r\n\t\t\t\t\ttype:\"gcj02\" ,\r\n\t\t\t\t\tisHighAccuracy:true ,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tconsole.log(\"调用uni-getlocation\")\r\n\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t\tthis.latitude = res.latitude\r\n\t\t\t\t\t\tthis.longitude = res.longitude\r\n\t\t\t\t\t\tthis.covers[0].latitude = res.latitude\r\n\t\t\t\t\t\tthis.covers[0].longitude = res.longitude\r\n\t\t\t\t\t\tif(this.isPointInPolygon(this.covers[0],this.polygons[0].points)){\r\n\t\t\t\t\t\t\t// uni.showToast({\r\n\t\t\t\t\t\t\t// \ttitle:\"在内部\"\r\n\t\t\t\t\t\t\t// })\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle:\"超出围栏\",\r\n\t\t\t\t\t\t\t\ticon:\"error\"\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// temp赋值\r\n\t\t\t\t\t\tthis.temp.vehicleId = this.vehicleId\r\n\t\t\t\t\t\tthis.temp.latitude = res.latitude\r\n\t\t\t\t\t\tthis.temp.longitude = res.longitude\r\n\t\t\t\t\t\tthis.temp.speed = res.speed\r\n\t\t\t\t\t\tthis.temp.accuracy = res.accuracy\r\n\t\t\t\t\t\t this.temp.reportTime = this.$utils.getCurrentTime() //获取时间字符串\r\n\t\t\t\t\t\tconsole.log(\"被插入的值\")\r\n\t\t\t\t\t\tconsole.log(this.temp)\r\n\t\t\t\t\t\t// // 单次插入\r\n\t\t\t\t\t\t// this.$api.insertLocation(this.temp).then((res) => {\r\n\t\t\t\t\t\t// \tconsole.log(\"插入成功\")\r\n\t\t\t\t\t\t// })\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//获取位置信息\r\n\t\t\t// async \r\n\t\t\tbgetLocationInfo(){\r\n\t\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\t\tuni.getLocation({\r\n\t\t\t\t\t\ttype: \"gcj02\",\r\n\t\t\t\t\t\tisHighAccuracy:true,\r\n\t\t\t\t\t\tsuccess(res){\r\n\t\t\t\t\t\t\t  location.longitude = res.longitude;\r\n\t\t\t\t\t\t\t  location.latitude = res.latitude;\r\n\t\t\t\t\t\t      console.log(\"成功返回值\")\r\n\t\t\t\t\t\t\t  console.log(res)\r\n\t\t\t\t\t\t\t\tconsole.log('当前位置的经度：' + res.longitude)\r\n\t\t\t\t\t\t\t\tconsole.log('当前位置的纬度：' + res.latitude)\r\n\t\t\t\t\t\t\t  const qqmapsdk = new QQMapWX({\r\n\t\t\t\t\t\t\t              key: 'QKJBZ-VXDE4-ZQMUP-DUWBN-OW4EH-GCBCM'  //这里填写自己申请的key\r\n\t\t\t\t\t\t\t       });\r\n\t\t\t\t\t\t\t\t  qqmapsdk.reverseGeocoder({\r\n\t\t\t\t\t\t\t\t\tlocation,\r\n\t\t\t\t\t\t\t\t\tsuccess(response) {\r\n\t\t\t\t\t\t\t\t\t  let info = response.result;\r\n\t\t\t\t\t\t\t\t\t  console.log(info);\r\n\t\t\t\t\t\t\t\t\t  location.province = info.address_component.province;\r\n\t\t\t\t\t\t\t\t\t  location.city = info.address_component.city;\r\n\t\t\t\t\t\t\t\t\t  location.area = info.address_component.district;\r\n\t\t\t\t\t\t\t\t\t  location.street = info.address_component.street;\r\n\t\t\t\t\t\t\t\t\t  location.address = info.address;\r\n\t\t\t\t\t\t\t\t\t  // position = info.address;\r\n\t\t\t\t\t\t\t\t\t  resolve(location);\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t  });\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(err){\r\n\t\t\t\t\t\t  console.log(err)\r\n\t\t\t\t\t\t  resolve(location)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 初始化多边形\r\n\t\t\tinitPolygons(){\r\n\t\t\t\tlet that = this\r\n\t\t\t\tthat.$api.getFence({id:1}).then((res) => {\r\n\t\t\t\t\tconsole.log('更新电子围栏')\r\n\t\t\t\t\tthat.fence =  res.datas\r\n\t\t\t\t\tlet tmpPoints = JSON.parse(that.fence.points)\r\n\t\t\t\t\tvar points = []\r\n\t\t\t\t\t// 封装新的结构\r\n\t\t\t\t\ttmpPoints.forEach((item) => {\r\n\t\t\t\t\t\tpoints.push({\r\n\t\t\t\t\t\t\tlatitude:item.lat,\r\n\t\t\t\t\t\t\tlongitude: item.lng\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthat.polygons=[\r\n\t\t\t\t\t  {\r\n\t\t\t\t\t    points: points,\r\n\t\t\t\t\t    strokeWidth: 2,\r\n\t\t\t\t\t\tstrokeColor: '#1492ff', // 描边的颜色\n                        fillColor: '#b0cfff94', // 填充颜色\r\n\t\t\t\t\t    zIndex: 1,\r\n\t\t\t\t\t  },\r\n\t\t\t\t\t]\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 判度是否在多边形内部\r\n\t\t\tisPointInPolygon(point, polygon) {\r\n\t\t\t  let inside = false;\r\n\t\t\t  const x = point.latitude;\r\n\t\t\t  const y = point.longitude;\r\n\t\t\t\r\n\t\t\t  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\r\n\t\t\t    const xi = polygon[i].latitude;\r\n\t\t\t    const yi = polygon[i].longitude;\r\n\t\t\t    const xj = polygon[j].latitude;\r\n\t\t\t    const yj = polygon[j].longitude;\r\n\t\t\t\r\n\t\t\t    const intersect = ((yi > y)   !== (yj > y)) && (x < ((xj - xi) * (y - yi)) / (yj - yi) + xi);\r\n\t\t\t    if (intersect) {\r\n\t\t\t      inside = !inside;\r\n\t\t\t    }\r\n\t\t\t  }\r\n\t\t\t  return inside;\r\n\t\t\t},\r\n\t\t\tmoreThanOneHour(time1) {\r\n\t\t\t  const date = new Date(time1)\r\n\t\t\t  const date2 = new Date()\r\n\t\t\t  // 超过一天\r\n\t\t\t  if ((date2.getTime() - date.getTime()) > 3600 * 1000 ) {\r\n\t\t\t\treturn true\r\n\t\t\t  } else {\r\n\t\t\t\treturn false\r\n\t\t\t  }\r\n\t\t\t},\r\n\t\t\tasync sendRequest1() {\r\n\t\t\t\tlet res = await this.$api.queryLocation({\r\n\t\t\t\t\tvehicleId: 1,\r\n\t\t\t\t\tstartTime: '2023-04-06 07:03:11'\r\n\t\t\t\t});\r\n\t\t\t\t// this.res = '请求结果 : ' + JSON.stringify(res);\r\n\t\t\t\tconsole.log(\"请求结果\")\r\n\t\t\t\tconsole.log(res)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\r\n\t.map{\r\n\t\twidth: 100%;\r\n\t\theight: 500rpx;\r\n\t}\r\n\t.content {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.logo {\r\n\t\theight: 200rpx;\r\n\t\twidth: 200rpx;\r\n\t\tmargin-top: 200rpx;\r\n\t\tmargin-left: auto;\r\n\t\tmargin-right: auto;\r\n\t\tmargin-bottom: 50rpx;\r\n\t}\r\n\r\n\t.text-area {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.title {\r\n\t\tfont-size: 36rpx;\r\n\t\tcolor: #8f8f94;\r\n\t}\r\n\r\n\t.input {\r\n\t\tmargin-top: 30rpx;\r\n\t\twidth: 500rpx;\r\n\t}\r\n\r\n\t.btn {\r\n\t\twidth: 500rpx;\r\n\t}\r\n</style>\n","import mod from \"-!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1683560460402\n      var cssReload = require(\"D:/HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}